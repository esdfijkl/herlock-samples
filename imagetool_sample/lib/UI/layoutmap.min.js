var UI;!function(UI){!function(LayoutMap){function toEnum(enumType,value){return"undefined"!=typeof enumType[value]?enumType[value]:0}var Sequence=hlk.command.Sequence,Call=hlk.command.Call,Loader=hlk.command.Loader,ObjectUtil=hlk.utils.ObjectUtil,StringUtil=hlk.utils.StringUtil;!function(VerticalAlign){VerticalAlign[VerticalAlign.TOP=0]="TOP",VerticalAlign[VerticalAlign.MIDDLE=1]="MIDDLE",VerticalAlign[VerticalAlign.BOTTOM=2]="BOTTOM"}(LayoutMap.VerticalAlign||(LayoutMap.VerticalAlign={}));var VerticalAlign=LayoutMap.VerticalAlign;!function(HorizontalAlign){HorizontalAlign[HorizontalAlign.LEFT=0]="LEFT",HorizontalAlign[HorizontalAlign.CENTER=1]="CENTER",HorizontalAlign[HorizontalAlign.RIGHT=2]="RIGHT"}(LayoutMap.HorizontalAlign||(LayoutMap.HorizontalAlign={}));var HorizontalAlign=LayoutMap.HorizontalAlign;LayoutMap.toEnum=toEnum;var LayoutRectangle=function(){function LayoutRectangle(data){this.data=data}return Object.defineProperty(LayoutRectangle.prototype,"x",{get:function(){return"undefined"!=typeof this.data.x?parseInt(this.data.x):0},enumerable:!0,configurable:!0}),Object.defineProperty(LayoutRectangle.prototype,"y",{get:function(){return"undefined"!=typeof this.data.y?parseInt(this.data.y):0},enumerable:!0,configurable:!0}),Object.defineProperty(LayoutRectangle.prototype,"width",{get:function(){return"undefined"!=typeof this.data.width?parseInt(this.data.width):0},enumerable:!0,configurable:!0}),Object.defineProperty(LayoutRectangle.prototype,"height",{get:function(){return"undefined"!=typeof this.data.height?parseInt(this.data.height):0},enumerable:!0,configurable:!0}),LayoutRectangle.prototype.getRectangle=function(){return new Rectangle(this.x,this.y,this.width,this.height)},LayoutRectangle}();LayoutMap.LayoutRectangle=LayoutRectangle;var LayoutItem=function(){function LayoutItem(data){var param=data.param;this.name=data.id,this.verticalAlign=Number(param.verticalAlign),this.horizontalAlign=Number(param.horizontalAlign),this.src=String(data.src),this.x=Number(param.x),this.y=Number(param.y),this.alpha=Number(param.alpha),this.rotation=Number(param.rotation),this.visible=!!param.visible,this.width=Number(param.width),this.height=Number(param.height),this.clipRect=param.clipRect?new LayoutRectangle(param.clipRect):null,this.isWrap=!!param.isWrap}return LayoutItem}();LayoutMap.LayoutItem=LayoutItem;var LayoutDataParser=function(){function LayoutDataParser(){}return LayoutDataParser.parseResolver=function(data){for(var items=[],itr=data.items,i=0;i<itr.length;i++)items.push(new LayoutItem(itr[i]));return items},LayoutDataParser.parse=function(data){var modules={},moduleName;for(moduleName in data)data.hasOwnProperty(moduleName)&&(modules[moduleName]=this.parseResolver(data[moduleName]));return modules},LayoutDataParser}(),LayoutResolverFactory=function(){function LayoutResolverFactory(data){"undefined"==typeof data&&(data={}),this.setConfig(data),this.id=StringUtil.getUnique()}return LayoutResolverFactory.prototype.addConfig=function(data){this.data=ObjectUtil.merge(this.data,LayoutDataParser.parse(data))},LayoutResolverFactory.prototype.setConfig=function(data){this.data=LayoutDataParser.parse(data)},LayoutResolverFactory.prototype.loadConfig=function(src,callback){var _this=this,xhr=new XMLHttpRequest;xhr.addEventListener("readystatechange",function(event){if(4===xhr.readyState){var data=JSON.parse(xhr.responseText);_this.addConfig(data),callback()}},!1),xhr.open("get",src),xhr.send(null)},LayoutResolverFactory.prototype.getConfig=function(resolverName){return this.data[resolverName]},LayoutResolverFactory.prototype.createResolver=function(resolverName){var config=this.getConfig(resolverName);if(!config)throw new Error("resolver config not exists!");return new LayoutResolver(resolverName,config)},LayoutResolverFactory.prototype.loadResolver=function(resolverName,materials,callback){var _this=this,sequence=new Sequence;sequence.add(new Loader(materials)),sequence.add(new Call(function(loadeds){_this.loadConfig(LayoutResolverFactory.DEFAULT_CONFIG_FILE,function(){var resolver=_this.createResolver(resolverName);for(var name in loadeds)loadeds.hasOwnProperty(name)&&loadeds[name]instanceof Image&&resolver.addImage(loadeds[name]);callback(resolver)})})),sequence.execute(null)},LayoutResolverFactory.DEFAULT_CONFIG_FILE="assets/layout.json",LayoutResolverFactory}();LayoutMap.LayoutResolverFactory=LayoutResolverFactory;var LayoutResolver=function(){function LayoutResolver(name,config){this.name=name,this.config=config,this.imageStore={},this.bitmapDataStore={}}return LayoutResolver.prototype.get=function(itemName,isWrapSprite){"undefined"==typeof isWrapSprite&&(isWrapSprite=void 0);var configs=this.config.filter(function(value,index,array){return value.name===itemName});return configs.length>0?this.getItem(configs[0],isWrapSprite):null},LayoutResolver.prototype.getItem=function(config,isWrapSprite){var bmp,target,isWrap="undefined"!=typeof isWrapSprite?isWrapSprite:!!config.isWrap;if("undefined"==typeof this.bitmapDataStore[config.src]){if("undefined"==typeof this.imageStore[config.src])throw new Error("not exists image.");this.bitmapDataStore[config.src]=new BitmapData(this.imageStore[config.src]),delete this.imageStore[config.src]}if(bmp=new Bitmap(this.bitmapDataStore[config.src]),config.clipRect&&bmp.setClippingRect(config.clipRect.getRectangle()),bmp.height=config.height,bmp.width=config.width,isWrap){var container=new Sprite;container.addChild(bmp),this.setAlign(bmp,config),target=container}else target=bmp;return this.setLayout(target,config),target},LayoutResolver.prototype.setAlign=function(target,param){param.horizontalAlign===HorizontalAlign.CENTER?target.x=-target.width/2:param.horizontalAlign===HorizontalAlign.RIGHT&&(target.x=-target.width),param.verticalAlign===VerticalAlign.MIDDLE?target.y=-target.height/2:param.verticalAlign===VerticalAlign.BOTTOM&&(target.y=-target.height)},LayoutResolver.prototype.setLayout=function(target,param){target.name=param.name,target.x=param.x,target.y=param.y,target.alpha=param.alpha,target.rotation=param.rotation},LayoutResolver.prototype.getItems=function(isWrapSprite){var items=[],i;for(i=0;i<this.config.length;i++){var config=this.config[i];items[i]=this.getItem(config,isWrapSprite)}return items},LayoutResolver.prototype.addChildTo=function(itemName,stage,isWrapSprite){"undefined"==typeof isWrapSprite&&(isWrapSprite=void 0);var item=this.get(itemName,isWrapSprite);stage.addChild(item)},LayoutResolver.prototype.addChildrenTo=function(stage,isWrapSprite){"undefined"==typeof isWrapSprite&&(isWrapSprite=void 0),this.getItems(isWrapSprite).forEach(function(item){stage.addChild(item)})},LayoutResolver.prototype.addImage=function(image){this.imageStore[image.src.replace(LayoutResolver.URL_PATTERN,"")]=image},LayoutResolver.prototype.addBitmapData=function(src,bitmapData){this.bitmapDataStore[src.replace(LayoutResolver.URL_PATTERN,"")]=bitmapData},LayoutResolver.prototype.clear=function(){var name;for(name in this.bitmapDataStore)this.bitmapDataStore.hasOwnProperty(name)&&delete this.bitmapDataStore[name];for(name in this.imageStore)this.imageStore.hasOwnProperty(name)&&delete this.bitmapDataStore[name]},LayoutResolver.URL_PATTERN=/^https?:\/\/[-_.!~*\'()a-zA-Z0-9;?:\@&=+\$,%#]+\/workspace\/.*?\/.*?\//,LayoutResolver}();LayoutMap.LayoutResolver=LayoutResolver}(UI.LayoutMap||(UI.LayoutMap={}));var LayoutMap=UI.LayoutMap}(UI||(UI={}));